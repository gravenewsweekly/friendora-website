<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendora.space - Connect with Friends</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-container">
            <h1><i class="fas fa-users"></i> Friendora.space</h1>
            <nav>
                <ul id="navLinks">
                    <li id="authLink"><a href="signup.html"><i class="fas fa-user-plus"></i> Signup</a></li>
                    <li><a href="about.html"><i class="fas fa-info-circle"></i> About</a></li>
                    <li><a href="terms.html"><i class="fas fa-file-contract"></i> Terms</a></li>
                    <li><a href="privacy.html"><i class="fas fa-shield-alt"></i> Privacy</a></li>
                    <li><a href="feed.html"><i class="fas fa-newspaper"></i> Feed</a></li>
                    <li><a href="qans.html"><i class="fas fa-question-circle"></i> Q/Ans</a></li>
                </ul>
                <div id="userDropdown" class="dropdown" style="display: none;">
                    <span id="usernameDisplay"><i class="fas fa-user-circle"></i> <span id="usernameText"></span></span>
                    <div class="dropdown-content">
                        <a href="edit-profile.html"><i class="fas fa-user-edit"></i> Edit Profile</a>
                        <a href="profile.html"><i class="fas fa-user"></i> View Profile</a>
                        <a href="login.html" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Log Out</a>
                    </div>
                </div>
            </nav>
            <button id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content">
                <h2>Connect with Friends, Share Your World</h2>
                <p>Join our growing community to meet new people, share moments, and build meaningful connections.</p>
                <div class="cta-buttons">
                    <a href="signup.html" class="btn primary">Get Started</a>
                    <a href="#features" class="btn secondary">Learn More</a>
                </div>
                <div class="real-time-stats">
                    <div class="stat">
                        <i class="fas fa-users"></i>
                        <span id="totalUsers">0</span> Users Online
                    </div>
                    <div class="stat">
                        <i class="fas fa-comments"></i>
                        <span id="totalPosts">0</span> Posts Today
                    </div>
                </div>
            </div>
            <div class="hero-image">
                <img src="https://images.unsplash.com/photo-1517486808906-6ca8b3f8e1c1?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="People connecting">
            </div>
        </section>

        <section id="features" class="features">
            <h2>Why Choose Friendora.space?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <i class="fas fa-user-shield"></i>
                    <h3>Safe Space</h3>
                    <p>Our community guidelines ensure a respectful environment for everyone.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-heart"></i>
                    <h3>Real Connections</h3>
                    <p>Find people who share your interests and values.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-comments"></i>
                    <h3>Engaging Discussions</h3>
                    <p>Participate in meaningful Q&A sessions with the community.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-bolt"></i>
                    <h3>Real-time Updates</h3>
                    <p>See friend activity and new posts as they happen.</p>
                </div>
            </div>
        </section>

        <section class="search">
            <h2>Find Friends</h2>
            <form id="searchForm" onsubmit="handleSearch(event)">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search for a user..." required>
                    <button type="submit"><i class="fas fa-search"></i> Search</button>
                </div>
                <p id="searchError" class="error"></p>
            </form>
            <div id="recentUsers" class="recent-users">
                <h3>Recently Active Users <span class="refresh-btn" id="refreshUsers"><i class="fas fa-sync-alt"></i></span></h3>
                <div id="recentUsersList" class="users-list"></div>
            </div>
        </section>

        <section class="live-feed-preview">
            <h2>Live Community Activity <i class="fas fa-circle live-indicator"></i></h2>
            <div class="activity-feed" id="liveActivityFeed">
                <div class="activity-item">
                    <div class="activity-loader"></div>
                    <p>Loading live activity...</p>
                </div>
            </div>
        </section>

        <section class="testimonials">
            <h2>What Our Users Say</h2>
            <div class="testimonial-slider">
                <div class="testimonial active">
                    <p>"Friendora helped me reconnect with old friends and make new ones!"</p>
                    <div class="author">- Sarah J.</div>
                </div>
                <div class="testimonial">
                    <p>"The community here is so welcoming and supportive."</p>
                    <div class="author">- Michael T.</div>
                </div>
                <div class="testimonial">
                    <p>"I love how easy it is to find people with similar interests."</p>
                    <div class="author">- Priya K.</div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Friendora.space</h3>
                <p>Connecting people since 2025</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="terms.html">Terms of Service</a></li>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Connect</h3>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2025 Friendora.space. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const API_KEY = '$2a$10$HNoicrOUVIdSCO7LAZz2t.3eGaPo9B2sdd.H/Kld6QJNV/putNShO';
        const BIN_ID = '67e720848a456b79667ea63a';
        const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        let activityInterval;
        let statsInterval;

        // Get logged-in user from localStorage
        let loggedInUser = localStorage.getItem('loggedInUser') || null;

        // Update navigation based on login status
        function updateNavigation() {
            const authLink = document.getElementById('authLink');
            const userDropdown = document.getElementById('userDropdown');
            const usernameText = document.getElementById('usernameText');

            // Re-fetch loggedInUser in case it changed
            loggedInUser = localStorage.getItem('loggedInUser') || null;

            if (loggedInUser) {
                authLink.style.display = 'none';
                userDropdown.style.display = 'inline-block';
                usernameText.textContent = loggedInUser;
            } else {
                authLink.style.display = 'inline-block';
                authLink.innerHTML = '<a href="signup.html"><i class="fas fa-user-plus"></i> Signup</a>';
                userDropdown.style.display = 'none';
            }
        }

        // Fetch users from JSONBin
        async function fetchUsers() {
            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': API_KEY
                    }
                });
                if (!response.ok) throw new Error('Failed to fetch users');
                const data = await response.json();
                return data.record.users || [];
            } catch (error) {
                console.error('Error fetching users:', error);
                return [];
            }
        }

        // Sanitize input to prevent XSS
        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML.replace(/[<>&"']/g, '');
        }

        // Handle search functionality
        async function handleSearch(event) {
            event.preventDefault();
            const searchInput = sanitizeInput(document.getElementById('searchInput').value.trim());
            const searchError = document.getElementById('searchError');

            if (!searchInput || searchInput.length < 3) {
                searchError.textContent = 'Search term must be at least 3 characters.';
                return;
            }

            const users = await fetchUsers();
            const foundUser = users.find(user => user.username.toLowerCase() === searchInput.toLowerCase());

            if (foundUser) {
                window.location.href = `profile.html?username=${encodeURIComponent(foundUser.username)}`;
            } else {
                searchError.textContent = 'User not found. Try a different username.';
            }
        }

        // Display recent users
        async function displayRecentUsers() {
            const users = await fetchUsers();
            const recentUsersList = document.getElementById('recentUsersList');
            
            // Sort users by last active (simulated)
            const activeUsers = users
                .filter(user => user.profile && user.profile.onlineStatus === 'online')
                .sort(() => 0.5 - Math.random()) // Simulate recent activity
                .slice(0, 5);
            
            if (activeUsers.length > 0) {
                recentUsersList.innerHTML = activeUsers.map(user => `
                    <div class="user-card" onclick="window.location.href='profile.html?username=${encodeURIComponent(user.username)}'">
                        <div class="user-avatar">
                            ${user.profile && user.profile.flair ? user.profile.flair : 'ð¤'}
                            ${user.profile && user.profile.profilePic ? 
                                `<img src="${user.profile.profilePic}" alt="${user.username}" class="user-avatar-img">` : ''}
                        </div>
                        <div class="user-info">
                            <span class="username">${user.username}</span>
                            <span class="status online">Online</span>
                            <span class="last-seen">Active now</span>
                        </div>
                    </div>
                `).join('');
            } else {
                recentUsersList.innerHTML = '<p>No active users found.</p>';
            }
        }

        // Generate random activity
        function generateRandomActivity(users) {
            const activities = [
                'just posted a new update',
                'added new photos',
                'commented on a post',
                'liked a question',
                'joined a discussion',
                'updated their profile',
                'answered a question',
                'started following someone'
            ];
            
            const activeUsers = users.filter(u => u.profile?.onlineStatus === 'online');
            if (activeUsers.length === 0) return [];
            
            const numActivities = Math.min(5, activeUsers.length);
            const shuffledUsers = [...activeUsers].sort(() => 0.5 - Math.random()).slice(0, numActivities);
            
            return shuffledUsers.map(user => ({
                username: user.username,
                activity: activities[Math.floor(Math.random() * activities.length)],
                time: 'Just now',
                flair: user.profile?.flair || 'ð¤',
                profilePic: user.profile?.profilePic || null
            }));
        }

        // Update live activity feed
        async function updateLiveActivity() {
            const users = await fetchUsers();
            const activities = generateRandomActivity(users);
            const feed = document.getElementById('liveActivityFeed');
            
            if (activities.length > 0) {
                feed.innerHTML = activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-avatar">
                            ${activity.profilePic ? 
                                `<img src="${activity.profilePic}" alt="${activity.username}" class="activity-avatar-img">` : 
                                `<span class="activity-flair">${activity.flair}</span>`}
                        </div>
                        <div class="activity-content">
                            <strong>${activity.username}</strong> ${activity.activity}
                            <span class="activity-time">${activity.time}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                feed.innerHTML = '<div class="activity-item">No recent activity right now.</div>';
            }
        }

        // Update real-time stats
        async function updateRealTimeStats() {
            const users = await fetchUsers();
            const onlineUsers = users.filter(u => u.profile?.onlineStatus === 'online').length;
            const totalPosts = users.reduce((sum, user) => sum + (user.posts?.length || 0), 0);
            
            document.getElementById('totalUsers').textContent = onlineUsers;
            document.getElementById('totalPosts').textContent = totalPosts;
        }

        // Handle logout
        document.getElementById('logoutLink')?.addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('loggedInUser');
            loggedInUser = null;
            updateNavigation();
            window.location.href = 'login.html';
        });

        // Mobile menu toggle
        document.getElementById('mobileMenuBtn')?.addEventListener('click', function() {
            const navLinks = document.getElementById('navLinks');
            navLinks.style.display = navLinks.style.display === 'flex' ? 'none' : 'flex';
        });

        // Refresh users list
        document.getElementById('refreshUsers')?.addEventListener('click', function() {
            this.classList.add('refreshing');
            displayRecentUsers().then(() => {
                setTimeout(() => this.classList.remove('refreshing'), 500);
            });
        });

        // Testimonial slider
        function initTestimonialSlider() {
            const testimonials = document.querySelectorAll('.testimonial');
            let currentIndex = 0;
            
            function showTestimonial(index) {
                testimonials.forEach((testimonial, i) => {
                    testimonial.classList.toggle('active', i === index);
                });
            }
            
            setInterval(() => {
                currentIndex = (currentIndex + 1) % testimonials.length;
                showTestimonial(currentIndex);
            }, 5000);
        }

        // Initialize page
        window.onload = function() {
            updateNavigation();
            displayRecentUsers();
            initTestimonialSlider();
            
            // Start real-time updates
            updateLiveActivity();
            updateRealTimeStats();
            activityInterval = setInterval(updateLiveActivity, 10000); // Update every 10 seconds
            statsInterval = setInterval(updateRealTimeStats, 30000); // Update every 30 seconds
            
            // Listen for changes in localStorage
            window.addEventListener('storage', function(event) {
                if (event.key === 'loggedInUser') {
                    loggedInUser = localStorage.getItem('loggedInUser') || null;
                    updateNavigation();
                }
            });
        };

        // Clean up intervals when page unloads
        window.addEventListener('beforeunload', function() {
            clearInterval(activityInterval);
            clearInterval(statsInterval);
        });
    </script>
</body>
</html>
